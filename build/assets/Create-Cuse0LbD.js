import{l as y,T as E,q as C,h as U,A as F,m as Q,c as j,w as L,o as c,b as t,t as a,a as _,d as $,e as H,u as g,f as i,F as O,x as z,g as b,i as V,p as k}from"./app-0gpYHNfJ.js";import{_ as G}from"./AuthenticatedLayout-DpP4pYyG.js";import{_ as J}from"./InputError-BmnpY-8-.js";import{C as M}from"./vue-select-BRanwOoH.js";const K={class:"pagetitle"},R={class:"breadcrumb"},W={class:"breadcrumb-item"},X={class:"breadcrumb-item active"},Y={class:"section dashboard"},Z={class:"row"},tt={class:"col-lg-12"},et={class:"card"},st={class:"card-body"},ot={class:"card-title"},nt={class:"row mb-3"},at={for:"customerSelect",class:"col-sm-2 col-form-label"},lt={class:"col-sm-10"},ct={key:0,class:"row mb-3"},rt={for:"productTable",class:"col-sm-2 col-form-label"},it={class:"col-sm-10"},dt={class:"table"},ut=["onInput","onUpdate:modelValue","max"],mt=["onUpdate:modelValue"],vt=["value"],ht=["onClick"],pt={class:"row"},_t={class:"col-md-6"},bt={class:"col-md-6"},ft={class:"text-center"},yt=["disabled"],gt={key:0,class:"bi bi-save"},Vt={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Ct={__name:"Create",props:{products:Array,customers:Array,translations:Object},setup(o){const q=y(""),r=y(!1),d=y(null),u=o,m=E({customer_id:"",items:[],log:[],total_amount:0}),v=C([]),A=C([]),I=U(()=>q.value?u.customers.filter(e=>{const s=q.value.toLowerCase();return e.name.toLowerCase().includes(s)||e.phone.includes(s)}):u.customers),P=e=>{const s=u.products.find(p=>p.id===e.product_id);s&&(e.price=s.price,e.max_quantity=s.max_quantity)},S=e=>{const s=u.products.find(p=>p.id===e.product_id);s&&e.quantity>s.max_quantity&&(e.quantity=s.max_quantity)},f=U(()=>v.reduce((e,s)=>e+s.quantity*s.price,0));F(f,e=>{m.total_amount=e});const B=()=>{v.push({product_id:"",quantity:1,price:0}),h("product_added")},N=e=>{v.splice(e,1),h("product_removed")},T=e=>{console.log(e),d.value=e,m.customer_id=e?e.id:null,h(`customer_selected ${e?e.name:""}`)},h=e=>{const s=new Date().toLocaleString();A.push({message:e,timestamp:s})},D=()=>{r.value=!0,m.items=v,m.post(route("orders.store"),{onSuccess:()=>{r.value=!1,h("invoice_saved")},onError:()=>{r.value=!1,h("invoice_save_failed")}})};return(e,s)=>{const p=Q("Link");return c(),j(G,{translations:o.translations},{default:L(()=>{var w;return[t("div",K,[t("h1",null,a(o.translations.invoice),1),t("nav",null,[t("ol",R,[t("li",W,[_(p,{class:"nav-link",href:e.route("dashboard")},{default:L(()=>[$(a(o.translations.Home),1)]),_:1},8,["href"])]),t("li",X,a(o.translations.invoice),1)])])]),t("section",Y,[t("div",Z,[t("div",tt,[t("div",et,[t("div",st,[t("h5",ot,a(o.translations.create_invoice),1),t("form",{onSubmit:H(D,["prevent"]),class:"row g-3"},[t("div",nt,[t("label",at,a(o.translations.client),1),t("div",lt,[_(g(M),{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=n=>d.value=n),options:I.value,label:"name","track-by":"id",reduce:n=>({id:n.id,name:n.name}),onMouseleave:s[1]||(s[1]=n=>T(d.value)),clearable:!0,placeholder:o.translations.select_customer},null,8,["modelValue","options","reduce","placeholder"]),_(J,{message:g(m).errors.customer},null,8,["message"])])]),d.value?(c(),i("div",ct,[t("label",rt,a(o.translations.products),1),t("div",it,[t("table",dt,[t("thead",null,[t("tr",null,[t("th",null,a(o.translations.product),1),t("th",null,a(o.translations.quantity),1),t("th",null,a(o.translations.price),1),t("th",null,a(o.translations.total),1),t("th",null,a(o.translations.actions),1)])]),t("tbody",null,[(c(!0),i(O,null,z(v,(n,x)=>(c(),i("tr",{key:x},[_(g(M),{modelValue:n.product_id,"onUpdate:modelValue":l=>n.product_id=l,options:o.products,label:"name",reduce:l=>l.id,placeholder:o.translations.select_product,class:"form-control",style:{"min-width":"200px"},onMouseleave:l=>P(n)},null,8,["modelValue","onUpdate:modelValue","options","reduce","placeholder","onMouseleave"]),t("td",null,[V(t("input",{type:"number",onInput:l=>S(n),"onUpdate:modelValue":l=>n.quantity=l,min:"1",max:n.max_quantity,class:"form-control",placeholder:"Quantity"},null,40,ut),[[k,n.quantity]])]),t("td",null,[V(t("input",{type:"number","onUpdate:modelValue":l=>n.price=l,min:"0",class:"form-control",placeholder:"Price"},null,8,mt),[[k,n.price]])]),t("td",null,[t("input",{type:"number",value:n.quantity*n.price,class:"form-control",disabled:""},null,8,vt)]),t("td",null,[t("button",{type:"button",class:"btn btn-danger",onClick:l=>N(x)},s[3]||(s[3]=[t("i",{class:"bi bi-trash"},null,-1)]),8,ht)])]))),128))])]),(w=o.products)!=null&&w.length?(c(),i("button",{key:0,type:"button",class:"btn btn-primary",onClick:B},a(o.translations.add_product),1)):b("",!0)])])):b("",!0),t("div",pt,[t("div",_t,[t("strong",null,a(u.translations.total)+":",1)]),t("div",bt,[V(t("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=n=>f.value=n),class:"form-control",readonly:""},null,512),[[k,f.value]])])]),t("div",ft,[t("button",{type:"submit",class:"btn btn-primary",disabled:r.value},[$(a(o.translations.save)+" Â  ",1),r.value?b("",!0):(c(),i("i",gt)),r.value?(c(),i("span",Vt)):b("",!0)],8,yt)])],32)])])])])])]}),_:1},8,["translations"])}}};export{Ct as default};
